var NAILS_Admin_Blog_Create_Edit;NAILS_Admin_Blog_Create_Edit=function(t,e){this.blog_id=null,this.upload_token=null,this._api=null,this.sMode=t,this.sInitialPublishState=e,this.init=function(t,e){this.blog_id=t,this.upload_token=e,this._api=new window.NAILS_API,this.initTabs(),this._init_publish_date(),this._init_comments(),this._init_type(),this._init_select2(),this._init_gallery(),this._init_submit_btn_txt(),this._init_preview()},this.initTabs=function(){$("ul.tabs a").on("click",function(){var t=$(this).data("tab");$("#activeTab").val(t)})},this._init_publish_date=function(){var t=this;$("#is-published").on("change",function(){t._publish_change()}),$("#is-published").closest("div.field").on("toggle",function(){t._publish_change()}),this._publish_change()},this._publish_change=function(){var t=$("#is-published").is(":checked");if(t){$("#field-publish-date").show();var e=$.trim($("#field-publish-date input.datetime").val());if(e.length<=0){var i=new Date,a=i.getFullYear(),s=i.getMonth()+1,n=i.getDate(),l=i.getHours(),o=i.getMinutes();1===s.toString().length&&(s="0"+s),1===n.toString().length&&(n="0"+n),1===l.toString().length&&(l="0"+l),1===o.toString().length&&(o="0"+o);var r=a+"-"+s+"-"+n+" "+l+":"+o;$("#field-publish-date input.datetime").val(r)}}else $("#field-publish-date").hide();_nails.addStripes()},this._init_comments=function(){var t=this;$("#comments-enabled").on("change",function(){t.commentsChange()}),$("#comments-enabled").closest("div.field").on("toggle",function(){t.commentsChange()}),this.commentsChange()},this.commentsChange=function(){var t=$("#comments-enabled").is(":checked");t?$("#field-comments-expire").show():$("#field-comments-expire").hide(),_nails.addStripes()},this._init_type=function(){var t=this;$("#post-type").on("change",function(){t.typeChange()}),this.typeChange(),$("#post-type-fields-photo").on("click","img,a",function(){var t=$(this).closest(".type-fields").data("manager-url");return t.length&&(t+=t.indexOf("?")>=0?"&isModal=1":"?isModal=1",$.fancybox.open({href:t,type:"iframe",iframe:{preload:!1}})),!1})},this.typePhotoCdnManagerCallback=function(t,e,i){var a=$("#post-type-fields-photo").data("url-scheme");return a=a.replace("{{width}}",500),a=a.replace("{{height}}",500),a=a.replace("{{bucket}}",t),a=a.replace("{{filename}}{{extension}}",e),$("#post-type-fields-photo img").attr("src",a),$("#post-type-fields-photo input").val(i),!0},this.typeChange=function(){var t=$("#post-type").val();$(".type-fields").hide(),$("#post-type-fields-"+t.toLowerCase()).show()},this._init_select2=function(){var t=this,e={},i={};e.categories="#tab-categories select.categories",i.categories=window.SITE_URL+"admin/blog/category/index/"+this.blog_id+"?isModal=1",e.tags="#tab-tags select.tags",i.tags=window.SITE_URL+"admin/blog/tag/index/"+this.blog_id+"?isModal=1",$(document).on("click","a.manage-categories",function(){return $.fancybox.open(i.categories,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t._rebuild_select2(e.categories)}}),!1}),$(document).on("click","a.manage-tags",function(){return $.fancybox.open(i.tags,{type:"iframe",width:"95%",height:"95%",beforeClose:function(){t._rebuild_select2(e.tags)}}),!1}),$("ul.tabs a:not(.disabled)").on("click",function(){setTimeout(function(){$(e.categories).trigger("change"),$(e.tags).trigger("change")},1)})},this._rebuild_select2=function(t){var e=$(".fancybox-iframe").get(0).contentWindow._DATA;if("undefined"==typeof e)return!1;var i=$(t);return i.length?void i.each(function(){var t=this,i=[];$("option:selected",this).each(function(){i.push(parseInt($(this).val(),10))}),$(this).empty(),$.each(e,function(){var e=$("<option>");e.val(this.id),e.html(this.label),$.inArray(this.id,i)>-1&&e.prop("selected",!0),$(t).append(e)}),$(this).trigger("change")}):!1},this._init_gallery=function(){var t=this;$("#file_upload").uploadify({debug:!1,auto:!0,swf:window.NAILS.URL+"packages/uploadify/uploadify.swf",queueID:"gallery-items",uploader:window.SITE_URL+"api/cdn/object/create",fileSizeLimit:2048,fileObjName:"upload",fileTypeExts:"*.gif; *.jpg; *.jpeg; *.png",formData:{token:this.upload_token,bucket:"blog-post-gallery","return":"URL|THUMB|100x100,34x34"},itemTemplate:$("#template-uploadify").html(),onSelect:function(){$("#gallery-items li.gallery-item").length&&$("#gallery-items li.empty").fadeOut(250,function(){$(this).parent().removeClass("empty")})},onUploadStart:function(){$("#post-form").off("submit"),$("#post-form").on("submit",function(){return!1}),"undefined"!=typeof CKEDITOR.instances.post_body&&CKEDITOR.instances.post_body.destroy(),"undefined"!=typeof CKEDITOR.instances.post_excerpt&&CKEDITOR.instances.post_excerpt.destroy();var t="Uploading...",e=$("#post-form input[type=submit]").val();window.onbeforeunload=function(){return"Uploads are in progress. Leaving this page will cause them to stop."},$("ul.tabs li a").addClass("disabled"),$("#upload-message").show(),e!==t&&$("#post-form input[type=submit]").attr({"data-old_val":e,disabled:"disabled"}).val("Uploading...")},onQueueComplete:function(){$("#post-form").off("submit"),$("#post-form input[type=submit]").removeAttr("disabled").val($("#post-form input[type=submit]").data("old_val")),window.onbeforeunload=null,$("ul.tabs li a").removeClass("disabled"),$("#upload-message").hide(),"undefined"==typeof CKEDITOR.instances.post_body&&$("#post_body").ckeditor({customConfig:window.NAILS.URL+"js/ckeditor.config.default.min.js"}),"undefined"==typeof CKEDITOR.instances.post_excerpt&&$("#post_excerpt").ckeditor({customConfig:window.NAILS.URL+"js/ckeditor.config.basic.min.js"})},onUploadProgress:function(t,e,i){var a=e/i*100;$("#"+t.id+" .progress").css("height",a+"%")},onUploadSuccess:function(t,e){var i;try{i=JSON.parse(e)}catch(a){i={}}var s=$.trim($("#template-gallery-item").html()),n=$($.parseHTML(s));n.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(n);var l=$("#"+t.id+"-complete");if(l.length||(s=$.trim($("#template-gallery-item").html()),n=$($.parseHTML(s)),n.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(n),l=$("#"+t.id+"-complete")),200===i.status){var o=$("<img>").attr("src",i.object_url[0]).on("load",function(){l.removeClass("crunching")}),r=$("<a>").attr({href:"#","class":"delete","data-object_id":i.object_id});l.append(o).append(r).find("input").val(i.object_id),o=$("<img>").attr({src:i.object_url[1]});var c=$("<input>").attr({type:"checkbox",value:i.object_id}),d=$("<li>").addClass("image object-id-"+i.object_id).append(c).append(o);$("#product-variations .variation").each(function(){c.attr("name","variation["+$(this).data("counter")+"][gallery][]"),$("ul.gallery-associations",this).removeClass("empty"),d.clone().insertBefore($("ul.gallery-associations li.actions",this))});var u=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));c.attr("name","variation[{{counter}}][gallery][]"),$("ul.gallery-associations",u).removeClass("empty"),d.clone().insertBefore($("ul.gallery-associations li.actions",u)),$("#template-variation").html($(u).html())}else{var p=$("<p>").addClass("filename").text(t.name),m=$("<p>").addClass("message").text(i.error);l.addClass("error").append(p).append(m).removeClass("crunching")}},onUploadError:function(t,e,i,a){var s=$("#"+t.id+"-complete");if(!s.length){var n=$.trim($("#template-gallery-item").html()),l=$($.parseHTML(n));l.attr("id",t.id+"-complete"),$("#"+t.id).replaceWith(l),s=$("#"+t.id+"-complete")}var o=$("<p>").addClass("filename").text(t.name),r=$("<p>").addClass("message").text(a);s.addClass("error").append(o).append(r).removeClass("crunching")}}),$("#gallery-items").disableSelection().sortable({placeholder:"gallery-item placeholder",items:"li.gallery-item"}),$(document).on("click","#gallery-items .gallery-item .remove",function(){var t=$(this).data("instance_id"),e=$(this).data("file_id");return $("#"+t).uploadify("cancel",e),$("#"+e+" .data-cancel").text("Cancelled").show(),$("#"+e).addClass("cancelled"),0===$("#gallery-items li.gallery-item:not(.cancelled)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250)),!1}),$(document).on("click","#gallery-items .gallery-item .delete",function(){var e=this;return $("#dialog-confirm-delete").dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"no-close",buttons:{"Delete Image":function(){var i=$(e).data("object_id"),a={controller:"cdn/object",method:"delete",action:"POST",data:{object_id:i}};t._api.call(a),$(e).closest("li.gallery-item").addClass("deleted").fadeOut("slow",function(){$(e).closest("li.gallery-item").remove()}),$(".image.object-id-"+i).remove();var s=$("<div>").html($.parseHTML($.trim($("#template-variation").html(),null,!0)));$(".image.object-id-"+i,s).remove(),0===$("#gallery-items li.gallery-item:not(.deleted)").length&&($("#gallery-items").addClass("empty"),$("#gallery-items li.empty").css("opacity",0).delay(1e3).animate({opacity:1},250),$("ul.gallery-associations").addClass("empty"),$("ul.gallery-associations",s).addClass("empty")),$("#template-variation").html($(s).html()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),!1})},this._init_submit_btn_txt=function(){var t=this;$("#field-is-published").on("toggle",function(){setTimeout(function(){t.calcSubmitBtnTxt()},100)}),$("#field-publish-date input").on("change",function(){setTimeout(function(){t.calcSubmitBtnTxt()},100)}),t.calcSubmitBtnTxt()},this.calcSubmitBtnTxt=function(){var t,e=moment(),i=$("#field-publish-date input").val(),a=$("#field-is-published .toggle").data("toggles").active;i.length?(i+=":00",t=moment(i,"YYYY-MM-DD HH:mm:ss")):t=moment(),"CREATE"===this.sMode?a?t.isAfter(e)?this.setSubmitBtnTxt("Schedule Post","warning"):this.setSubmitBtnTxt("Publish Now","success"):this.setSubmitBtnTxt("Save Draft"):"EDIT"===this.sMode&&("PUBLISHED"===this.sInitialPublishState?a?t.isAfter(e)?this.setSubmitBtnTxt("Unpublish & Schedule Post","warning"):this.setSubmitBtnTxt("Update Post","success"):this.setSubmitBtnTxt("Unpublish & Save Draft"):"SCHEDULED"===this.sInitialPublishState?a?t.isAfter(e)?this.setSubmitBtnTxt("Schedule Post","warning"):this.setSubmitBtnTxt("Publish Now","success"):this.setSubmitBtnTxt("Unschedule Post & Save as Draft"):"DRAFT"===this.sInitialPublishState&&(a?t.isAfter(e)?this.setSubmitBtnTxt("Schedule Post","warning"):this.setSubmitBtnTxt("Publish Now","success"):this.setSubmitBtnTxt("Update Draft")))},this.setSubmitBtnTxt=function(t,e){e=e||"default",$("#btnSubmit").text(t).attr("class","btn btn-"+e)},this._init_preview=function(){var t=this;$("#btnPreview").on("click",function(){return t._submit_preview(),!1})},this._submit_preview=function(){var t=$("#post-form").attr("target")||"";$("#post-form").attr("target","_blogPreview"),$("#isPreview").val(1),$("#btnSubmit").click(),$("#isPreview").val(0),$("#post-form").attr("target",t)}};
//# sourceMappingURL=admin.post.edit.min.js.map
